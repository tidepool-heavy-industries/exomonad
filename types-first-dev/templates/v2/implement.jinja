# Task: Implement {{ icSpec.specDescription }}

{% if icIsGlueLayer %}
## Mode: Glue Layer Implementation

Your subsystem stubs have been implemented by child tasks.
Their MRs have been merged into your branch.
Now implement the orchestration layer that ties them together.

### What Children Implemented
{% for child in icChildResults %}
- **{{ child.crSubsystemName }}**: merged from `{{ child.crBranch }}`
{% endfor %}

{% else %}
## Mode: Direct Implementation

No subsystems were identified. Implement all stubs directly.
{% endif %}

## Scaffolding Summary

Plan: {{ icScaffoldingResult.srOutput.soPlan }}

Tests written:
{% for test in icScaffoldingResult.srOutput.soTestsWritten %}
- {{ test }}
{% endfor %}

Stubs created:
{% for stub in icScaffoldingResult.srOutput.soStubsCreated %}
- {{ stub }}
{% endfor %}

## Your Task

1. **Implement the stubs** in `{{ icSpec.specTargetPath }}`
   - Replace `undefined` with actual implementations
   {% if icIsGlueLayer %}
   - Use the now-real subsystem modules
   - Focus on orchestration and integration
   {% else %}
   - Implement all functions directly
   {% endif %}

2. **Run tests and iterate**
   ```bash
   cabal test
   ```
   - If tests fail, analyze and fix
   - Repeat until all tests pass

3. **Commit your implementation**
   ```bash
   git add {{ icSpec.specTargetPath }}
   git commit -m "impl: {{ icSpec.specDescription }}"
   ```

## Structured Output

Return:

- `ioFunctionsImpl`: List of functions you implemented
- `ioTestsPassing`: true if all tests pass, false otherwise
- `ioCommitHash`: The commit hash of your implementation
- `ioIterations`: How many test/fix cycles you went through

## Critical

- Do NOT skip the test loop. Run `cabal test` and iterate.
- If you cannot make tests pass after 5 iterations, return with `ioTestsPassing: false`.
- The commit should only be created if tests pass.
