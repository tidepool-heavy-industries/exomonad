# Task: Implement {{ spec.description }}

{% if isGlueLayer %}
## Mode: Glue Layer Implementation

Your subsystem stubs have been implemented by child tasks.
Their MRs have been merged into your branch.
Now write the code layer that combines them.

### What Children Implemented
{% for child in childResults %}
- **{{ child.subsystemName }}**: merged from `{{ child.branch }}`
{% endfor %}

{% else %}
## Mode: Direct Implementation

No subsystems were identified. Implement all stubs directly.
{% endif %}

## Scaffolding Summary

Plan: {{ scaffoldingResult.output.plan }}

Tests written:
{% for test in scaffoldingResult.output.testsWritten %}
- {{ test }}
{% endfor %}

Stubs created:
{% for stub in scaffoldingResult.output.stubsCreated %}
- {{ stub }}
{% endfor %}

## Your Task

1. **Implement the stubs** in `{{ spec.targetPath }}`
   - Replace `undefined` with actual implementations
   {% if isGlueLayer %}
   - Use the now-real subsystem modules
   - Focus on orchestration and integration
   {% else %}
   - Implement all functions directly
   {% endif %}

2. **Run tests and iterate**
   ```bash
   cabal test
   ```
   - If tests fail, analyze and fix
   - Repeat until all tests pass

3. **Commit your implementation**
   ```bash
   git add {{ spec.targetPath }}
   git commit -m "impl: {{ spec.description }}"
   ```

## Structured Output

Return:

- `ioFunctionsImpl`: List of functions you implemented
- `ioTestsPassing`: true if all tests pass, false otherwise
- `ioCommitHash`: The commit hash of your implementation
- `ioIterations`: How many test/fix cycles you went through

## Critical

- Create a commit
- CI _will_ run all tests, so they need to all pass.
- If you cannot make tests pass after 5 iterations, return with `ioTestsPassing: false`.
