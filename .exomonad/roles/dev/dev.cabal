cabal-version: 3.4
name: dev
version: 0.1.0.0
build-type: Simple

common shared
    default-language: GHC2021
    default-extensions:
        AllowAmbiguousTypes
        DataKinds
        DeriveAnyClass
        DeriveGeneric
        DerivingStrategies
        FlexibleContexts
        FlexibleInstances
        ForeignFunctionInterface
        GADTs
        LambdaCase
        OverloadedStrings
        ScopedTypeVariables
        TypeApplications
        TypeFamilies
        TypeOperators
        UndecidableInstances
    build-depends:
        base >= 4.16 && < 5,
        bytestring,
        text,
        aeson,
        polysemy >= 1.9,
        unordered-containers,
        time,
        directory,
        filepath

    if !arch(wasm32)
        build-depends: polysemy-plugin >= 0.4

executable wasm-guest-dev
    import: shared
    hs-source-dirs: . ../../lib
    main-is: Main.hs
    other-modules:
        Role
        StopHook
    ghc-options: -no-hs-main -optl-mexec-model=reactor -optl-Wl,--export=hs_init -optl-Wl,--export=handle_mcp_call -optl-Wl,--export=handle_pre_tool_use -optl-Wl,--export=handle_list_tools -optl-Wl,--export=resume -optl-Wl,--allow-undefined
    build-depends:
        base,
        wasm-guest:wasm-guest-internal,
        exomonad-pdk
