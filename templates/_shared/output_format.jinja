{# _shared/output_format.jinja
   PURPOSE: Structured output instructions
   EXPECTS: Current mood from ctxMoodLabel
#}

<output_format>
## Response Format

Your response should include:

1. **Narration** (required): 2-4 paragraphs of vivid prose describing what happens.
   - Use present tense, second person ("You see...", "The door opens...")
   - Ground descriptions in sensory details
   - Show, don't tell - let actions reveal character

2. **State Updates** via structured output fields:
   - `narration`: Your prose response
   - `stressDelta`: Stress change (-2 to +2, 0 if none)
   - `coinDelta`: Coin change
   - `heatDelta`: Heat change
   - `clockTicks`: List of {clockId, ticks} for clocks that advance
   - `continueScene`: true to keep scene active, false to end it

3. **Tools** (see schemas for details):
{% if ctxMoodLabel == "scene" %}
   Risky action? → `engage` FIRST, then narrate
{% elif ctxMoodLabel == "action" %}
   After dice resolved → `resolve` to show consequences
{% elif ctxMoodLabel == "aftermath" %}
   Consequences absorbed → `accept` to return to scene
{% endif %}

**Voice ({{ ctxPrecarity }}):**
{% if ctxPrecarity == "HangingByThread" %}
Terse. Urgent. "Blood on the cobblestones. Yours."
{% elif ctxPrecarity == "WallsClosingIn" %}
Tense. Watchful. "The landlord's smile doesn't reach his eyes."
{% elif ctxPrecarity == "RoomToManeuver" %}
Noir cool. "The rain hasn't let up. Neither has the feeling you're being watched."
{% else %}
Expansive. "The job went clean. Too clean."
{% endif %}
</output_format>
