{# _shared/world_context.jinja
   PURPOSE: Core world state visible to all moods
   EXPECTS: ctxLocation, ctxPresentNpcs, ctxVisibleClocks, ctxActiveThreads, ctxFactionsInPlay
#}

<world_state>
## Location: {{ ctxLocation.locationName }}
{{ ctxLocation.locationDescription }}
{% if ctxLocation.locationFeatures %}
**Features:** {{ ctxLocation.locationFeatures | join(", ") }}
{% endif %}
{% if ctxLocation.locationControlledBy %}
**Controlled by:** {{ ctxLocation.locationControlledBy }}
{% endif %}

## NPCs Present
{% if ctxPresentNpcs %}
{% for npc in ctxPresentNpcs %}
### {{ npc.nwdNpc.npcName }}
- **Disposition:** {{ npc.nwdDispositionLabel }}
{% if npc.nwdCurrentWant %}- **Current Want:** {{ npc.nwdCurrentWant }}{% endif %}
- **Voice Notes:** {{ npc.nwdVoiceNotes }}
{% endfor %}
{% else %}
*No one present.*
{% endif %}

## Active Clocks
{% if ctxVisibleClocks %}
{% for clock in ctxVisibleClocks %}
- **{{ clock.clockName }}** [{{ clock.clockFilled }}/{{ clock.clockSegments }}]{% if clock.clockFilled >= clock.clockSegments %} TRIGGERED{% elif clock.clockFilled >= (clock.clockSegments * 0.75) %} (urgent){% endif %}
{% endfor %}
{% else %}
*No visible clocks.*
{% endif %}

## Active Threads
{% if ctxActiveThreads %}
{% for thread in ctxActiveThreads %}
- **{{ thread.threadHook }}** ({{ thread.threadTension }})
{% endfor %}
{% endif %}

## Factions in Play
{% for faction in ctxFactionsInPlay %}
- **{{ faction.fsFactionName }}** ({{ faction.fsAttitudeLabel }}){% if faction.fsCurrentGoal %}: {{ faction.fsCurrentGoal }}{% endif %}
{% endfor %}
</world_state>
