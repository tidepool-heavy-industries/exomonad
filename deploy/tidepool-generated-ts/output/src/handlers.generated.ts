// Auto-generated by generate-ts-package - DO NOT EDIT

import type { SerializableEffect, EffectResult } from './protocol.js';
import { errorResult } from './protocol.js';

// Internal effect types (handled by StateMachineDO, not yielded to caller)
export type InternalEffectType = "LogInfo" | "LogError" | "LlmComplete" | "Habitica";

/**
 * Handler interface for internal effects.
 *
 * TEnv is the environment type (e.g., Cloudflare Worker Env).
 * Each handler receives the specific effect type and environment.
 */
export interface InternalEffectHandlers<TEnv> {
  LogInfo: (effect: Extract<SerializableEffect, { type: "LogInfo" }>, env: TEnv) => Promise<EffectResult>;
  LogError: (effect: Extract<SerializableEffect, { type: "LogError" }>, env: TEnv) => Promise<EffectResult>;
  LlmComplete: (effect: Extract<SerializableEffect, { type: "LlmComplete" }>, env: TEnv) => Promise<EffectResult>;
  Habitica: (effect: Extract<SerializableEffect, { type: "Habitica" }>, env: TEnv) => Promise<EffectResult>;
}

/**
 * Dispatch an internal effect to the appropriate handler.
 *
 * @param effect - The effect to execute
 * @param handlers - Registry of handler functions
 * @param env - Environment with bindings
 * @returns Promise resolving to success/error result
 */
export function dispatchInternalEffect<TEnv>(
  effect: SerializableEffect,
  handlers: InternalEffectHandlers<TEnv>,
  env: TEnv
): Promise<EffectResult> {
  switch (effect.type) {
    case "LogInfo":
      return handlers.LogInfo(
        effect as Extract<SerializableEffect, { type: "LogInfo" }>,
        env
      );

    case "LogError":
      return handlers.LogError(
        effect as Extract<SerializableEffect, { type: "LogError" }>,
        env
      );

    case "LlmComplete":
      return handlers.LlmComplete(
        effect as Extract<SerializableEffect, { type: "LlmComplete" }>,
        env
      );

    case "Habitica":
      return handlers.Habitica(
        effect as Extract<SerializableEffect, { type: "Habitica" }>,
        env
      );

    default:
      return Promise.resolve(errorResult(
        `Unknown internal effect type: ${(effect as { type: string }).type}`
      ));
  }
}
