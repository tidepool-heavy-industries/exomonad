# Haskell→Rust Wiring + Dead Code Cleanup

## Goal

Complete the migration to socket-based services and remove all dead code. Faster builds, cleaner codebase.

## Part 1: Remove OpenAI Code (~3-4hrs)

OpenAI is unused - we only use Anthropic. Remove all stub code.

### Files to Clean

**llm-interpreter:**
```
haskell/effects/llm-interpreter/src/ExoMonad/LLM/
├── API/OpenAI.hs          # DELETE entirely
├── Interpreter.hs         # Remove SOpenAI handling, openaiRequest
└── Types.hs               # Remove OpenAISecrets, OpenAIConfig
```

**dsl/core (effect types):**
```
haskell/dsl/core/src/ExoMonad/Effects/LLMProvider.hs
# Remove SOpenAI, OpenAIConfig, OpenAIResponse
```

**socket-client:**
```
haskell/effects/socket-client/src/ExoMonad/Effects/SocketClient.hs
# Remove any OpenAI ServiceRequest variants (if present)
```

### Steps
- [ ] Delete `API/OpenAI.hs`
- [ ] Remove OpenAI from `Interpreter.hs` (SOpenAI case, openaiRequest function)
- [ ] Remove OpenAI types from `Types.hs`
- [ ] Remove OpenAI from `LLMProvider.hs` effect type
- [ ] Update exports in all affected modules
- [ ] `cabal build exomonad-llm-interpreter`

## Part 2: Remove native-server (~1hr)

Already partially done. Complete removal:

- [ ] Delete `haskell/native-server/` directory (if still exists)
- [ ] Remove from `cabal.project`
- [ ] Update all CLAUDE.md references
- [ ] Remove any imports in other packages

## Part 3: Remove Dead HTTP Code Path (~2-3hrs)

The llm-interpreter has two paths:
- `LLMHttpConfig` - Direct HTTP via servant-client (DEAD in Claude Code++)
- `LLMSocketConfig` - Via Rust service-server (USED)

Keep socket path, remove HTTP path:

- [ ] Remove `anthropicRequest`, `openaiRequest` functions (direct HTTP)
- [ ] Remove servant-client dependency
- [ ] Remove `LLMHttpConfig` constructor (keep only `LLMSocketConfig`)
- [ ] Simplify `socketRequest` to be the only path
- [ ] Update `mkLLMEnv` to only handle socket config

**Note:** `haskell/dsl/teaching/` uses `LLMHttpConfig` - check if it needs socket migration or should keep HTTP for standalone use.

## Part 4: Remove Disabled Packages (~1-2hrs)

These are commented out in cabal.project but directories exist:

```
types-first-dev/        # Depends on deleted session-interpreter
human-driven-dev/       # Depends on deleted session-interpreter
```

- [ ] Delete `types-first-dev/` directory
- [ ] Delete `human-driven-dev/` directory
- [ ] Remove comments from `cabal.project`

## Part 5: Remove Unused Interpreters (~2-3hrs)

These are in `cabal.project` but not used by `control-server`:

Check each:
```bash
grep -r "exomonad-log-interpreter" haskell/control-server/
grep -r "exomonad-devlog-interpreter" haskell/control-server/
grep -r "exomonad-ui-interpreter" haskell/control-server/
```

If unused:
- [ ] Remove from `control-server.cabal` build-depends
- [ ] Consider removing packages entirely (or move to contrib/)

## Part 6: Remove Telegram Haskell (~30min)

Superseded by TypeScript `telegram-bot`:

- [ ] Delete `haskell/effects/telegram/` directory
- [ ] Remove from `cabal.project` if present

## Verification

```bash
# Full build
cabal build all

# Check no OpenAI references remain
grep -r "OpenAI\|openai" haskell/effects/llm-interpreter/
# Should be empty

# Check build speed improvement
time cabal build exomonad-control-server
# Compare before/after
```

## Branch

`gh-374/haskell-rust-wiring-cleanup`
