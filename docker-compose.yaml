services:
  orchestrator:
    build:
      context: .
      dockerfile: docker/orchestrator/Dockerfile
      target: runtime
    container_name: tidepool-orchestrator
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - HANGAR_ROOT=/worktrees
      - TIDEPOOL_CONTROL_SOCKET=/sockets/control.sock
      - TIDEPOOL_TUI_SOCKET=/sockets/tui.sock
    volumes:
      - .:/worktrees
      - tidepool-sockets:/sockets
      - ${LOCAL_CLAUDE_CONFIG_DIR:-~/.claude}:/mnt/host-auth:ro
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "7432:7432"
    restart: unless-stopped
    command: ["orchestrator"]

volumes:
  tidepool-sockets:
    name: tidepool-sockets
