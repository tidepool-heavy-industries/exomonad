[package]
name = "exomonad-core"
version = "0.1.0"
edition = "2021"
description = "ExoMonad core: effect system, MCP server, Tidepool backend, shared types"
license = "BSD-3-Clause"
repository = "https://github.com/tidepool-heavy-industries/exomonad"
homepage = "https://github.com/tidepool-heavy-industries/exomonad"
keywords = ["agent", "mcp", "automation", "tidepool"]
categories = ["development-tools"]

[features]
default = ["runtime"]
runtime = [
    "dep:async-trait",
    "dep:anyhow",
    "dep:frunk",
    "dep:libc",
    "dep:clap",
    "dep:duct",
    "dep:strum",
    "dep:tokio",
    "dep:tracing",
    "dep:tracing-subscriber",
    "dep:uuid",
    "dep:shell-escape",
    "dep:nix",
    "dep:askama",
    "dep:chrono",
    "dep:dirs",
    "dep:octocrab",
    "dep:ollama-rs",
    "dep:reqwest",
    "dep:url",
    "dep:thiserror",
    "dep:axum",
    "dep:tower-http",
    "dep:futures-util",
    "dep:jj-lib",
    "dep:tidepool-repr",
    "dep:tidepool-eval",
    "dep:tidepool-heap",
    "dep:tidepool-bridge",
    "dep:tidepool-bridge-derive",
    "dep:tidepool-effect",
    "dep:tidepool-macro",
    "dep:schemars",
]

[dependencies]
# Always available (lightweight types for plugin consumers)
serde = { workspace = true }
serde_json = { workspace = true }
schemars = { version = "1", optional = true }

# Runtime feature: workspace deps
async-trait = { workspace = true, optional = true }
anyhow = { workspace = true, optional = true }
libc = { version = "0.2", optional = true }
clap = { workspace = true, optional = true }
duct = { workspace = true, optional = true }
futures-util = { workspace = true, optional = true }
strum = { workspace = true, optional = true }
thiserror = { workspace = true, optional = true }
tokio = { workspace = true, optional = true }
tracing = { workspace = true, optional = true }
tracing-subscriber = { workspace = true, optional = true }
uuid = { workspace = true, optional = true }

frunk = { version = "0.4", optional = true }

# Runtime feature: shared types
shell-escape = { version = "0.1", optional = true }
nix = { workspace = true, features = ["fs"], optional = true }

# Runtime feature: jj-lib (workspace management)
jj-lib = { workspace = true, optional = true }

# Runtime feature: handlers and services
askama = { version = "0.12", optional = true }
chrono = { version = "0.4", optional = true }
dirs = { version = "5.0", optional = true }
octocrab = { version = "0.38", optional = true }
ollama-rs = { version = "0.2", optional = true }
reqwest = { version = "0.12", features = ["json", "rustls-tls"], default-features = false, optional = true }
url = { version = "2", optional = true }

# Runtime feature: HTTP transport
axum = { version = "0.8", optional = true }
tower-http = { version = "0.6", features = ["cors"], optional = true }

# Tidepool: Cranelift-compiled Haskell Core
tidepool-repr = { version = "0.0.1", optional = true }
tidepool-eval = { version = "0.0.1", optional = true }
tidepool-heap = { version = "0.0.1", optional = true }
tidepool-bridge = { version = "0.0.1", optional = true }
tidepool-bridge-derive = { version = "0.0.1", optional = true }
tidepool-effect = { version = "0.0.1", optional = true, features = ["async"] }
tidepool-macro = { version = "0.0.1", optional = true }


[dev-dependencies]
async-trait = { workspace = true }
proptest = "1.4"
serde_json = { workspace = true }
tempfile = { workspace = true }
tokio = { workspace = true }
tracing-subscriber = { workspace = true }
wiremock = "0.6"

[lib]
path = "src/lib.rs"
