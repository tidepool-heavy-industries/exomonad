syntax = "proto3";
package exomonad.effects.events;

message WaitForEventRequest {
  repeated string types = 1;
  int32 timeout_secs = 2;
  uint64 after_event_id = 3;  // Skip events with id <= this value. 0 means no filtering.
}

message WaitForEventResponse {
  Event event = 1;
}

message NotifyEventRequest {
  string session_id = 1;
  Event event = 2;
}

message NotifyEventResponse {
  bool success = 1;
}

message Event {
  uint64 event_id = 3;  // Monotonically increasing ID assigned by EventQueue
  oneof event_type {
    WorkerComplete worker_complete = 1;
    Timeout timeout = 2;
  }
}

message WorkerComplete {
  string worker_id = 1;
  string status = 2;
  repeated string changes = 3;
  string message = 4;
}

message Timeout {
  int32 timeout_secs = 1;
}

// ============================================================================
// NotifyParent - Notify parent session of worker completion
// ============================================================================

message NotifyParentRequest {
  string status = 1;    // "success" | "failure"
  string message = 2;   // completion message
}

message NotifyParentResponse {
  bool ack = 1;
}

service EventEffects {
  rpc WaitForEvent(WaitForEventRequest) returns (WaitForEventResponse);
  rpc NotifyEvent(NotifyEventRequest) returns (NotifyEventResponse);
  rpc NotifyParent(NotifyParentRequest) returns (NotifyParentResponse);
}
