{"id":"tidepool-6qa","title":"urchin prime: worktree-aware context generator","description":"Build a CLI tool that generates focused context for Claude Code sessions based on current worktree, bd state, and project context. Inspired by gastown's gt prime.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-04T16:42:22.09033911-08:00","created_by":"inanna","updated_at":"2026-01-04T16:42:22.09033911-08:00"}
{"id":"tidepool-6qa.1","title":"Implement WorktreeInfo type and git detection","description":"Create Tidepool/BD/Prime/Worktree.hs with git worktree detection.\n\n## Types\n\n```haskell\ndata WorktreeInfo = WorktreeInfo\n  { wiName     :: Text      -- \"bd\", \"native-server\", etc (from path)\n  , wiPath     :: FilePath  -- /home/.../worktrees/bd\n  , wiBranch   :: Text      -- feat/bd (current branch)\n  , wiRepoRoot :: FilePath  -- /home/.../tidepool (git root)\n  }\n```\n\n## Functions\n\n- `detectWorktree :: IO (Maybe WorktreeInfo)` - Parse `git worktree list --porcelain`\n- `detectFromCwd :: IO (Maybe WorktreeInfo)` - Detect from current directory\n- `worktreeName :: FilePath -\u003e Text` - Extract name from path (last component of worktrees/X)\n\n## Git Commands Used\n\n```bash\ngit worktree list --porcelain  # Get all worktrees\ngit rev-parse --show-toplevel  # Get repo root\ngit branch --show-current      # Get current branch\n```\n\n## Acceptance Criteria\n\n- [ ] Detects main repo vs worktree correctly\n- [ ] Handles case when not in a git repo (returns Nothing)\n- [ ] Extracts worktree name from path","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T16:42:35.464053029-08:00","created_by":"inanna","updated_at":"2026-01-04T16:50:32.130506312-08:00","dependencies":[{"issue_id":"tidepool-6qa.1","depends_on_id":"tidepool-6qa","type":"parent-child","created_at":"2026-01-04T16:42:35.470993518-08:00","created_by":"inanna"}]}
{"id":"tidepool-6qa.2","title":"Implement PrimeContext and context gathering","description":"Create Tidepool/BD/Prime.hs with context aggregation and rendering.\n\n## Types\n\n```haskell\ndata PrimeContext = PrimeContext\n  { pcWorktree      :: WorktreeInfo\n  , pcBranch        :: Text\n  , pcDirtyFiles    :: [FilePath]\n  , pcRecentCommits :: [Text]        -- Last 5 commits (subject only)\n  , pcInProgress    :: [BeadInfo]    -- status=in_progress\n  , pcReady         :: [BeadInfo]    -- Unblocked, status=open\n  , pcHooked        :: [BeadInfo]    -- status=hooked (propulsion)\n  , pcEpicContext   :: Maybe BeadInfo -- Epic matching worktree name\n  }\n\ndata EpicMatch = EpicMatch\n  { emEpic     :: BeadInfo\n  , emChildren :: [BeadInfo]\n  }\n```\n\n## Functions\n\n- `gatherContext :: BDConfig -\u003e WorktreeInfo -\u003e IO PrimeContext`\n  - Query bd for in_progress, ready (open + unblocked), hooked\n  - Get recent commits via `git log --oneline -5`\n  - Get dirty files via `git status --porcelain`\n  - Find epic by label or title matching worktree name\n\n- `renderPrime :: PrimeContext -\u003e Text`\n  - Markdown output with sections for git status, in-progress, ready, propulsion\n\n## BD Queries\n\n```bash\nbd list --status=in_progress --json\nbd list --status=open --json        # Then filter unblocked\nbd list --status=hooked --json\nbd list --type=epic --json          # Find matching epic\n```\n\n## Output Template\n\n```markdown\n# Urchin Prime: {worktree} / {branch}\n\n## Git Status\n- Branch: {branch}\n- Dirty: {count} files\n- Recent: {last_commit}\n\n## In Progress ({count})\n- [id] title (P{priority})\n\n## Ready ({count})\n- [id] title\n\n## Propulsion\n{if hooked} **HOOKED**: {title} - proceed immediately\n{else} No hooked work. Review Ready tasks.\n```","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T16:42:35.843612226-08:00","created_by":"inanna","updated_at":"2026-01-04T16:50:32.434965885-08:00","dependencies":[{"issue_id":"tidepool-6qa.2","depends_on_id":"tidepool-6qa","type":"parent-child","created_at":"2026-01-04T16:42:35.84433155-08:00","created_by":"inanna"},{"issue_id":"tidepool-6qa.2","depends_on_id":"tidepool-6qa.1","type":"blocks","created_at":"2026-01-04T16:42:46.475040561-08:00","created_by":"inanna"}]}
{"id":"tidepool-6qa.3","title":"Add 'prime' subcommand to urchin CLI","description":"Add 'prime' subcommand to bd-executor CLI.\n\n## CLI Interface\n\n```bash\nurchin prime                      # Auto-detect worktree, markdown output\nurchin prime --worktree=bd        # Explicit worktree\nurchin prime --format=json        # JSON for MCP/programmatic use\nurchin prime --format=markdown    # Default\nurchin prime --epic=tidepool-6qa  # Focus on specific epic's children\n```\n\n## Implementation\n\n1. Add to optparse-applicative parser in Main.hs\n2. Wire to Prime.gatherContext + Prime.renderPrime\n3. Support OutputFormat enum (Markdown | JSON)\n\n## Data Types\n\n```haskell\ndata PrimeOptions = PrimeOptions\n  { poWorktree :: Maybe Text      -- Override auto-detection\n  , poFormat   :: OutputFormat    -- markdown | json\n  , poEpic     :: Maybe Text      -- Focus on epic's children\n  }\n\ndata OutputFormat = FormatMarkdown | FormatJSON\n```\n\n## JSON Output Schema\n\n```json\n{\n  \"worktree\": { \"name\": \"bd\", \"path\": \"...\", \"branch\": \"feat/bd\" },\n  \"git\": { \"dirty_count\": 2, \"recent_commit\": \"...\" },\n  \"in_progress\": [{ \"id\": \"...\", \"title\": \"...\", \"priority\": 2 }],\n  \"ready\": [...],\n  \"hooked\": [...],\n  \"epic\": { \"id\": \"...\", \"title\": \"...\", \"children\": [...] }\n}\n```\n\n## Acceptance Criteria\n\n- [ ] `urchin prime` works from any worktree\n- [ ] `--format=json` produces valid JSON\n- [ ] `--worktree` override works\n- [ ] Graceful error when not in git repo","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T16:42:36.222947151-08:00","created_by":"inanna","updated_at":"2026-01-04T16:50:32.800310025-08:00","dependencies":[{"issue_id":"tidepool-6qa.3","depends_on_id":"tidepool-6qa","type":"parent-child","created_at":"2026-01-04T16:42:36.223662511-08:00","created_by":"inanna"},{"issue_id":"tidepool-6qa.3","depends_on_id":"tidepool-6qa.2","type":"blocks","created_at":"2026-01-04T16:42:46.622833898-08:00","created_by":"inanna"}]}
{"id":"tidepool-6qa.4","title":"Write tests for urchin prime","description":"Write tests for urchin prime functionality.\n\n## Test Categories\n\n### Unit Tests (Worktree.hs)\n\n- `detectWorktree` with mocked git output\n- `worktreeName` extracts correct name from various paths\n- Handles non-git directories gracefully\n\n### Unit Tests (Prime.hs)\n\n- `renderPrime` golden tests for markdown output\n- Empty state handling (no in-progress, no ready, no hooked)\n- Propulsion section appears only when hooked work exists\n\n### Integration Tests\n\n- Run `urchin prime` in actual bd worktree\n- Verify JSON output parses correctly\n- Verify markdown contains expected sections\n\n## Test Data\n\n```haskell\ntestWorktree :: WorktreeInfo\ntestWorktree = WorktreeInfo\n  { wiName = \"bd\"\n  , wiPath = \"/home/test/tidepool/worktrees/bd\"\n  , wiBranch = \"feat/bd\"\n  , wiRepoRoot = \"/home/test/tidepool\"\n  }\n\ntestContext :: PrimeContext\ntestContext = PrimeContext\n  { pcWorktree = testWorktree\n  , pcInProgress = [mockBead \"tidepool-1\" \"Task 1\" 2]\n  , pcReady = [mockBead \"tidepool-2\" \"Task 2\" 3]\n  , pcHooked = []\n  , ...\n  }\n```\n\n## Golden Test Files\n\n- `test/golden/prime-empty.md` - No tasks\n- `test/golden/prime-typical.md` - Mix of in-progress and ready\n- `test/golden/prime-hooked.md` - With propulsion work\n\n## Acceptance Criteria\n\n- [ ] All unit tests pass\n- [ ] Golden tests for markdown output\n- [ ] Integration test runs successfully in CI","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T16:42:36.727509335-08:00","created_by":"inanna","updated_at":"2026-01-04T16:50:33.180456263-08:00","dependencies":[{"issue_id":"tidepool-6qa.4","depends_on_id":"tidepool-6qa","type":"parent-child","created_at":"2026-01-04T16:42:36.735731301-08:00","created_by":"inanna"},{"issue_id":"tidepool-6qa.4","depends_on_id":"tidepool-6qa.3","type":"blocks","created_at":"2026-01-04T16:42:46.785883-08:00","created_by":"inanna"}]}
{"id":"tidepool-98i","title":"ClaudeCode graph integration","description":"Integrate ClaudeCode annotation with graph execution. Enables LLM nodes to spawn Claude Code sessions via zellij-cc instead of API calls.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-04T15:55:59.559380122-08:00","created_by":"inanna","updated_at":"2026-01-04T15:55:59.559380122-08:00"}
{"id":"tidepool-98i.1","title":"Add Backend + ClaudeCode annotations","description":"Add type-level annotations for Backend selection (CloudflareAI | NativeAnthropic) and ClaudeCode node annotation (model + cwd). PR #123.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T15:58:37.329341858-08:00","created_by":"inanna","updated_at":"2026-01-04T16:06:53.423837893-08:00","closed_at":"2026-01-04T16:06:53.423842743-08:00","external_ref":"gh-123","dependencies":[{"issue_id":"tidepool-98i.1","depends_on_id":"tidepool-98i","type":"parent-child","created_at":"2026-01-04T15:58:37.330420825-08:00","created_by":"inanna"}]}
{"id":"tidepool-98i.2","title":"Implement ClaudeCode executor","description":"Executor that renders template, spawns Claude Code via zellij-cc, parses JSON output. Runs in native-server worktree.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T15:58:37.643377962-08:00","created_by":"inanna","updated_at":"2026-01-04T15:58:37.643377962-08:00","dependencies":[{"issue_id":"tidepool-98i.2","depends_on_id":"tidepool-98i","type":"parent-child","created_at":"2026-01-04T15:58:37.643997221-08:00","created_by":"inanna"}]}
{"id":"tidepool-98i.3","title":"Build dev workflow graph in urchin","description":"Create the first dev workflow graph in ~/dev/urchin that uses BD reads/writes + Haskell logic + ClaudeCode invocation for a local helper.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-04T15:58:38.045171562-08:00","created_by":"inanna","updated_at":"2026-01-04T15:58:38.045171562-08:00","dependencies":[{"issue_id":"tidepool-98i.3","depends_on_id":"tidepool-98i","type":"parent-child","created_at":"2026-01-04T15:58:38.045754249-08:00","created_by":"inanna"}]}
