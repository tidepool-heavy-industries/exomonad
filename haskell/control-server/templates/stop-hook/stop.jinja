{# Only show uncommitted changes warning when blocking (no PR filed yet) #}
{% if dirty_files and not pr_exists %}
## Uncommitted Changes

The following files have uncommitted changes:
{% for f in git_dirty_files %}
- `{{ f }}`
{% endfor %}

Commit these changes before stopping. Use structured commit metadata:
```
git add <files>
git commit -m "[gh-{{ issue_number | default(branch) }}] <type>: <description>"
git push
```
{% endif %}

{% if commits_ahead > 0 and not pr_exists %}
## Ready for PR

You have some commit(s) on `{{ branch }}` not yet in a PR.

Use the `file_pr` MCP tool to create a pull request:
- **testing** (required): How did you verify this works?
- **compromises** (optional): Any tradeoffs or known limitations?

The tool will infer issue number and title from your branch.
{% endif %}

{% if pr_exists and pr.pending_comments > 0 %}
## Pending Feedback

You have **{{ pr.pending_comments }}** pending review comment(s).

Use the `pr_review_status` tool to check for required changes before stopping.
{% endif %}

{% if pr_exists %}
## PR Filed
{% if git_dirty_files %}
✓ PR #{{ pr_number }} filed. You have local uncommitted changes (not blocking since PR exists).
{% else %}
✓ PR #{{ pr_number }} is up to date.
{% endif %}
{% endif %}

{% if clean and not issue_number %}
✓ Clean state. Not on an issue branch.
{% endif %}

{% if clean and issue_number and pr_exists %}
✓ #{{ issue_number }}: All changes committed, PR #{{ pr_number }} filed.
{% endif %}

{# Pre-commit check results #}
{% if build_failed %}
## Build Checks

✗ Build failed:

```
{{ raw_output }}
```

Fix the issues above before stopping.
{% endif %}

{# Issue completion status #}
{% if stage == "StageComplete" %}
## Issue Completed

✓ #{{ issue_number }} has been completed (PR filed, checks passed).
{% endif %}