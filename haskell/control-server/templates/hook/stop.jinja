{# Only show uncommitted changes warning when blocking (no PR filed yet) #}
{% if dirty_files and not pr %}
## Uncommitted Changes

The following files have uncommitted changes:
{% for f in dirty_files %}
- `{{ f }}`
{% endfor %}

Commit these changes before stopping. Use structured commit metadata:
```
git add <files>
git commit -m "[gh-{{ issue_number | default(branch) }}] <type>: <description>"
git push
```
{% endif %}

{% if commits_ahead > 0 and not pr %}
## Ready for PR

You have {{ commits_ahead }} commit(s) on `{{ branch }}` not yet in a PR.

Use the `file_pr` MCP tool to create a pull request:
- **testing** (required): How did you verify this works?
- **compromises** (optional): Any tradeoffs or known limitations?

The tool will infer issue number and title from your branch.
{% endif %}

{# TODO: Wire pr_review_status to fetch actual pending_comments count #}

{% if pr %}
## PR Filed
{% if dirty_files %}
✓ PR #{{ pr.number }} filed. You have local uncommitted changes (not blocking since PR exists).
{% else %}
✓ PR #{{ pr.number }} is up to date.
{% endif %}
{% endif %}

{% if clean and not issue_number %}
✓ Clean state. Not on an issue branch.
{% endif %}

{% if clean and issue_number and pr %}
✓ #{{ issue_number }}: All changes committed, PR #{{ pr.number }} filed.
{% endif %}

{# Pre-commit check results #}
{% if pre_commit %}
## Pre-commit Checks

{% if pre_commit.success %}
✓ Pre-commit checks passed.
{% else %}
✗ Pre-commit checks failed:

```
{{ pre_commit.output }}
```

Fix the issues above before stopping.
{% endif %}
{% endif %}

{# Issue closing status #}
{% if issue_closed %}
## Issue Completed

✓ #{{ issue_number }} has been closed automatically (PR filed, checks passed).
{% elif issue_already_closed %}
ℹ #{{ issue_number }} was already closed.
{% endif %}
