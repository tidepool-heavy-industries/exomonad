syntax = "proto3";
package exomonad.effects.messaging;

// Agentâ†”TL messaging effects for inter-agent communication.

// ============================================================================
// SendNote - Fire-and-forget note from agent to TL
// ============================================================================

message SendNoteRequest {
  // Note content (plain text).
  string content = 1;
  reserved 2;
  reserved "team_name";
}

message SendNoteResponse {
  // Acknowledgment that the note was received.
  bool ack = 1;
}

// ============================================================================
// SendQuestion - Blocking question from agent to TL
// ============================================================================

message SendQuestionRequest {
  // Question content (plain text).
  string question = 1;
  // Reserved for the removed context field to preserve wire compatibility.
  reserved 2;
  reserved "context";
  reserved 3;
  reserved "team_name";
}

message SendQuestionResponse {
  // The TL's answer.
  string answer = 1;
}

// ============================================================================
// GetAgentMessages - TL reads messages from agent outboxes
// ============================================================================

message GetAgentMessagesRequest {
  // Filter to a specific agent. Empty string means all agents.
  string agent_id = 1;
  reserved 2;
  reserved "team_name";
  // Long-poll timeout in seconds (0 = immediate return, default).
  int32 timeout_secs = 3;
}

message AgentMessage {
  // Sender name.
  string from = 1;
  // Message content.
  string text = 2;
  // Short summary.
  string summary = 3;
  // ISO 8601 timestamp.
  string timestamp = 4;
  // Whether the message has been read.
  bool read = 5;
}

message AgentMessages {
  // Agent identifier.
  string agent_id = 1;
  // Messages from this agent.
  repeated AgentMessage messages = 2;
}

message GetAgentMessagesResponse {
  // Messages grouped by agent.
  repeated AgentMessages agents = 1;
  // Warning message (e.g. no team configured).
  string warning = 2;
}

// ============================================================================
// AnswerQuestion - TL answers a pending question from an agent
// ============================================================================

message AnswerQuestionRequest {
  // Agent who asked the question.
  string agent_id = 1;
  // Question ID to answer.
  string question_id = 2;
  // Answer text.
  string answer = 3;
  reserved 4;
  reserved "team_name";
}

message AnswerQuestionResponse {
  // Status of the answer (e.g. "answered").
  string status = 1;
  // Agent who was answered.
  string agent_id = 2;
  // Question that was answered.
  string question_id = 3;
}

// ============================================================================
// Service definition
// ============================================================================

service MessagingEffects {
  rpc SendNote(SendNoteRequest) returns (SendNoteResponse);
  rpc SendQuestion(SendQuestionRequest) returns (SendQuestionResponse);
  rpc GetAgentMessages(GetAgentMessagesRequest) returns (GetAgentMessagesResponse);
  rpc AnswerQuestion(AnswerQuestionRequest) returns (AnswerQuestionResponse);
}
