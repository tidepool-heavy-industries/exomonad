version: '3.8'

services:
  orchestrator:
    build:
      context: ../orchestrator
    image: exomonad-orchestrator:test
    container_name: test-orchestrator
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./sockets:/sockets
      - ../../:/worktrees
    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock
    labels:
      - "exomonad.test.role=orchestrator"

  agent:
    build:
      context: ../claude-agent
    image: exomonad-claude-agent:test
    container_name: test-agent
    volumes:
      - ./sockets:/home/agent/.exomonad/sockets
    environment:
      - EXOMONAD_CONTROL_SOCKET=/home/agent/.exomonad/sockets/control.sock
    labels:
      - "exomonad.test.role=agent"
    command: ["tail", "-f", "/dev/null"] # Keep it alive for testing
