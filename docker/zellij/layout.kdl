// Main Zellij layout for container separation architecture
// Panes connect to agent containers via docker attach

layout {
    default_tab_template {
        children
        pane size=1 borderless=true {
            plugin location="zellij:compact-bar"
        }
    }

    tab name="Agents" focus=true {
        pane split_direction="vertical" {
            // TL (Tech Lead) agent - main coding agent
            // Use --detach-keys to avoid conflict with outer docker attach (Ctrl+p,q)
            // Wrap in loop for auto-reconnect if container restarts
            pane name="TL" focus=true size="50%" {
                command "bash"
                args "-c" "while true; do docker attach --detach-keys 'ctrl-],]' tidepool-tl; echo '[TL disconnected - reconnecting in 2s]'; sleep 2; done"
            }

            // PM (Project Manager) agent - planning and coordination
            pane name="PM" size="50%" {
                command "bash"
                args "-c" "while true; do docker attach --detach-keys 'ctrl-],]' tidepool-pm; echo '[PM disconnected - reconnecting in 2s]'; sleep 2; done"
            }
        }
    }

    tab name="Infrastructure" {
        pane split_direction="horizontal" {
            // Control server logs
            pane name="Control Server" size="60%" {
                command "docker"
                args "logs" "-f" "tidepool-control-server"
            }

            pane split_direction="vertical" {
                // Container status
                pane name="Status" {
                    command "bash"
                    args "-c" "watch -c -n5 'docker ps --format \"table {{.Names}}\\t{{.Status}}\\t{{.Ports}}\" --filter name=tidepool'"
                }

                // Docker spawner logs
                pane name="Spawner" {
                    command "docker"
                    args "logs" "-f" "tidepool-docker-spawner"
                }
            }
        }
    }
}
