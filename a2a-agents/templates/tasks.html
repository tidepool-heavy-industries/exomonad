<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Expenses - Reimbursement</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <main class="container">
        <h1>ðŸ’¼ My Expense Requests</h1>
        <p>Track all your reimbursement requests ({{ total_count }} total)</p>

        <div class="task-filters">
            <a href="/tasks" class="filter-btn {% if filter_state.is_none() %}active{% endif %}">All</a>
            <a href="/tasks?state=submitted" class="filter-btn {% if filter_state == Some("submitted".to_string()) %}active{% endif %}">Submitted</a>
            <a href="/tasks?state=working" class="filter-btn {% if filter_state == Some("working".to_string()) %}active{% endif %}">Working</a>
            <a href="/tasks?state=completed" class="filter-btn {% if filter_state == Some("completed".to_string()) %}active{% endif %}">Completed</a>
            <a href="/tasks?state=failed" class="filter-btn {% if filter_state == Some("failed".to_string()) %}active{% endif %}">Failed</a>
            <a href="/tasks?state=canceled" class="filter-btn {% if filter_state == Some("canceled".to_string()) %}active{% endif %}">Canceled</a>
        </div>

        <div class="tasks-container">
            {% if tasks.is_empty() %}
            <p class="no-tasks">No expenses found. <a href="/">Submit your first expense</a> to get started.</p>
            {% else %}
            <div class="tasks-list">
                {% for task in tasks %}
                <div class="task-item">
                    <div class="task-header">
                        <span class="task-state task-state-{{ task.state|lower }}">{{ task.state }}</span>
                        <span class="task-id"><code>{{ task.task_id }}</code></span>
                    </div>
                    <div class="task-meta">
                        <span class="message-count">{{ task.message_count }} message{% if task.message_count != 1 %}s{% endif %}</span>
                    </div>
                    {% if task.last_message_preview.is_some() %}
                    <div class="task-preview">
                        {{ task.last_message_preview.as_ref().unwrap() }}
                        {% if task.last_message_preview.as_ref().unwrap().len() >= 100 %}...{% endif %}
                    </div>
                    {% endif %}
                    <div class="task-actions">
                        <a href="/chat/{{ task.task_id }}" class="btn-primary">Open Chat</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="actions">
            <a href="/">âž• Submit New Expense</a>
        </div>
    </main>
</body>
</html>
